---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { getTranslations } from "@/i18n/translations";
import { statusColors } from "@/utils/status";

const { currentLocale } = Astro;
const t = getTranslations(currentLocale as "en" | "zh");

const studioPosts = (await getCollection("studio"))
  .filter(
    (post) =>
      post.data.locale === currentLocale &&
      (import.meta.env.PROD ? !post.data.draft : true),
  )
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const libraryPosts = (await getCollection("library"))
  .filter(
    (post) =>
      post.data.locale === currentLocale &&
      (import.meta.env.PROD ? !post.data.draft : true),
  )
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const cafePosts = (await getCollection("cafe"))
  .filter(
    (post) =>
      post.data.locale === currentLocale &&
      (import.meta.env.PROD ? !post.data.draft : true),
  )
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const clubPosts = (await getCollection("club"))
  .filter(
    (post) =>
      post.data.locale === currentLocale &&
      (import.meta.env.PROD ? !post.data.draft : true),
  )
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout>
  <section class="max-w-5xl mx-auto px-6 sm:px-8 lg:px-12 py-20 sm:py-32">
    <div class="text-center space-y-8">
      <div class="space-y-4">
        <h1
          class="font-serif text-5xl sm:text-6xl lg:text-7xl font-semibold tracking-tight text-primary leading-tight"
        >
          Zen X Hunger
        </h1>
        <p class="text-2xl sm:text-3xl text-secondary font-light tracking-wide">
          思考 · 探索 · 品味
        </p>
      </div>
      <div
        class="w-16 h-px bg-gradient-to-r from-transparent via-accent/30 to-transparent mx-auto"
      >
      </div>
      <div class="max-w-3xl mx-auto pt-8">
        <div class="space-y-6 text-left">
          <h2
            class="text-2xl sm:text-3xl font-semibold text-primary/90 tracking-tight"
          >
            创作者宣言
          </h2>
          <p class="text-lg text-secondary leading-relaxed font-light">
            这是一个让想法从种子成长为树苗，再成为常青树的空间。
            在这里，我记录着在AI探索、文学反思和空间计算研究中的旅程。
            每一篇都是思考的瞬间——捕捉好奇心、实验和沿途培养的品味。
          </p>
          <p class="text-lg text-secondary leading-relaxed font-light italic">
            未完成。未打磨。但诚实且持续成长。
          </p>
        </div>
      </div>
    </div>
  </section>
  <section class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-16">
    <h2
      class="text-3xl sm:text-4xl font-semibold text-primary mb-16 tracking-tight"
    >
      最新文章
    </h2>
    <div class="mb-20">
      <div class="flex items-center justify-between mb-8">
        <h3
          class="text-2xl font-semibold text-stone-800 dark:text-stone-200 tracking-tight"
        >
          {t["nav.studio"]}
        </h3>
        <a
          href="/studio"
          class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-emerald-700 dark:hover:text-emerald-500 transition-all duration-200 flex items-center gap-1 group"
        >
          {t["viewAll"]}
          <svg
            class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {
        studioPosts.length > 0 ? (
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {studioPosts.map((post) => (
              <article class="group bg-surface rounded-xl border border-border-subtle p-7 hover:shadow-xl hover:shadow-stone-200/50 dark:hover:shadow-stone-900/50 hover:border-border-subtle hover:-translate-y-1 transition-all duration-300">
                <div class="flex items-center gap-2.5 mb-4">
                  <span
                    class={`text-xs font-medium px-3 py-1 rounded-full ${statusColors[post.data.status]}`}
                  >
                    {post.data.status}
                  </span>
                  <time class="text-xs text-secondary font-light">
                    {post.data.pubDate.toLocaleDateString(currentLocale, {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>
                </div>
                <h4 class="text-xl font-semibold text-primary mb-3 line-clamp-2 group-hover:text-accent transition-colors duration-200">
                  <a href={`/studio/${post.slug.split("/").pop()}`}>
                    {post.data.title}
                  </a>
                </h4>
                <p class="text-sm text-secondary leading-relaxed mb-5 line-clamp-3 font-light">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <span class="text-xs text-secondary bg-muted px-2.5 py-1 rounded-md font-light">
                      #{tag}
                    </span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        ) : (
          <p class="text-stone-500 dark:text-stone-400 italic font-light">
            {t["studio.noPosts"]}
          </p>
        )
      }
    </div>
    <div class="mb-20">
      <div class="flex items-center justify-between mb-8">
        <h3
          class="text-2xl font-semibold text-stone-800 dark:text-stone-200 tracking-tight"
        >
          {t["nav.library"]}
        </h3>
        <a
          href="/library"
          class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-emerald-700 dark:hover:text-emerald-500 transition-all duration-200 flex items-center gap-1 group"
        >
          {t["viewAll"]}
          <svg
            class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {
        libraryPosts.length > 0 ? (
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {libraryPosts.map((post) => (
              <article class="group bg-surface rounded-xl border border-border-subtle p-7 hover:shadow-xl hover:shadow-stone-200/50 dark:hover:shadow-stone-900/50 hover:border-border-subtle hover:-translate-y-1 transition-all duration-300">
                <div class="flex items-center gap-2.5 mb-4">
                  <span
                    class={`text-xs font-medium px-3 py-1 rounded-full ${statusColors[post.data.status]}`}
                  >
                    {post.data.status}
                  </span>
                  <time class="text-xs text-secondary font-light">
                    {post.data.pubDate.toLocaleDateString(currentLocale, {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>
                </div>
                <h4 class="text-xl font-semibold text-primary mb-3 line-clamp-2 group-hover:text-accent transition-colors duration-200">
                  <a href={`/library/${post.slug.split("/").pop()}`}>
                    {post.data.title}
                  </a>
                </h4>
                <p class="text-sm text-secondary leading-relaxed mb-5 line-clamp-3 font-light">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <span class="text-xs text-secondary bg-muted px-2.5 py-1 rounded-md font-light">
                      #{tag}
                    </span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        ) : (
          <p class="text-stone-500 dark:text-stone-400 italic font-light">
            {t["library.noPosts"]}
          </p>
        )
      }
    </div>
    <div class="mb-20">
      <div class="flex items-center justify-between mb-8">
        <h3
          class="text-2xl font-semibold text-stone-800 dark:text-stone-200 tracking-tight"
        >
          {t["nav.cafe"]}
        </h3>
        <a
          href="/cafe"
          class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-emerald-700 dark:hover:text-emerald-500 transition-all duration-200 flex items-center gap-1 group"
        >
          {t["viewAll"]}
          <svg
            class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {
        cafePosts.length > 0 ? (
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {cafePosts.map((post) => (
              <article class="group bg-surface rounded-xl border border-border-subtle p-7 hover:shadow-xl hover:shadow-stone-200/50 dark:hover:shadow-stone-900/50 hover:border-border-subtle hover:-translate-y-1 transition-all duration-300">
                <div class="flex items-center gap-2.5 mb-4">
                  <span
                    class={`text-xs font-medium px-3 py-1 rounded-full ${statusColors[post.data.status]}`}
                  >
                    {post.data.status}
                  </span>
                  <time class="text-xs text-secondary font-light">
                    {post.data.pubDate.toLocaleDateString(currentLocale, {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>
                </div>
                <h4 class="text-xl font-semibold text-primary mb-3 line-clamp-2 group-hover:text-accent transition-colors duration-200">
                  <a href={`/cafe/${post.slug.split("/").pop()}`}>
                    {post.data.title}
                  </a>
                </h4>
                <p class="text-sm text-secondary leading-relaxed mb-5 line-clamp-3 font-light">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <span class="text-xs text-secondary bg-muted px-2.5 py-1 rounded-md font-light">
                      #{tag}
                    </span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        ) : (
          <p class="text-stone-500 dark:text-stone-400 italic font-light">
            {t["cafe.noPosts"]}
          </p>
        )
      }
    </div>
    <div class="mb-20">
      <div class="flex items-center justify-between mb-8">
        <h3
          class="text-2xl font-semibold text-stone-800 dark:text-stone-200 tracking-tight"
        >
          {t["nav.club"]}
        </h3>
        <a
          href="/club"
          class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-emerald-700 dark:hover:text-emerald-500 transition-all duration-200 flex items-center gap-1 group"
        >
          {t["viewAll"]}
          <svg
            class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {
        clubPosts.length > 0 ? (
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {clubPosts.map((post) => (
              <article class="group bg-surface rounded-xl border border-border-subtle p-7 hover:shadow-xl hover:shadow-stone-200/50 dark:hover:shadow-stone-900/50 hover:border-border-subtle hover:-translate-y-1 transition-all duration-300">
                <div class="flex items-center gap-2.5 mb-4">
                  <span
                    class={`text-xs font-medium px-3 py-1 rounded-full ${statusColors[post.data.status]}`}
                  >
                    {post.data.status}
                  </span>
                  <time class="text-xs text-secondary font-light">
                    {post.data.pubDate.toLocaleDateString(currentLocale, {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>
                </div>
                <h4 class="text-xl font-semibold text-primary mb-3 line-clamp-2 group-hover:text-accent transition-colors duration-200">
                  <a href={`/club/${post.slug.split("/").pop()}`}>
                    {post.data.title}
                  </a>
                </h4>
                <p class="text-sm text-secondary leading-relaxed mb-5 line-clamp-3 font-light">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <span class="text-xs text-secondary bg-muted px-2.5 py-1 rounded-md font-light">
                      #{tag}
                    </span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        ) : (
          <p class="text-stone-500 dark:text-stone-400 italic font-light">
            {t["club.noPosts"]}
          </p>
        )
      }
    </div>
  </section>
</BaseLayout>
